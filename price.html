// price.js — PDF Viewer (Mobile-safe, no reload loop)

(function () {
  const params = new URLSearchParams(window.location.search);
  const title = params.get("title") || "";
  const pdfParam = params.get("pdf") || "";

  const titleEl = document.getElementById("pageTitle");
  const badgeEl = document.getElementById("pdfPathBadge");
  const statusEl = document.getElementById("statusText");
  const hostEl = document.getElementById("pdfHost");
  const openBtn = document.getElementById("openPdfBtn");

  if (titleEl) titleEl.textContent = title;
  if (badgeEl) badgeEl.textContent = `PDF: ${pdfParam || "-"}`;

  if (!pdfParam) {
    if (statusEl) statusEl.textContent = "ไม่พบไฟล์ PDF";
    return;
  }

  // แปลง path ให้รองรับ GitHub Pages (/price-webapp/)
  const base = location.pathname.includes("/price-webapp/")
    ? "/price-webapp/"
    : "/";

  const pdfUrl = pdfParam.startsWith("http")
    ? pdfParam
    : base + pdfParam.replace(/^\/+/, "");

  // ปุ่มเปิด PDF (ใช้ native viewer ของเครื่อง → คม ชัด ไม่ reload)
  if (openBtn) {
    openBtn.onclick = () => {
      window.open(pdfUrl, "_blank");
    };
  }

  // แสดง PDF แบบ inline เฉพาะ Desktop / Tablet
  const isMobile = /iphone|ipad|android/i.test(navigator.userAgent);

  if (isMobile) {
    if (statusEl) {
      statusEl.textContent =
        "อุปกรณ์มือถือ → ใช้ปุ่ม “เปิด PDF” เพื่อดูแบบคมชัด";
    }
    return;
  }

  // Desktop: ใช้ <object> (ไม่ใช้ iframe → เสถียรกว่า)
  const obj = document.createElement("object");
  obj.data = pdfUrl;
  obj.type = "application/pdf";
  obj.style.width = "100%";
  obj.style.height = "85vh";
  obj.style.borderRadius = "12px";
  obj.style.background = "#111";

  obj.onerror = () => {
    if (statusEl) statusEl.textContent = "โหลด PDF ไม่สำเร็จ";
  };

  hostEl.appendChild(obj);

  if (statusEl) statusEl.textContent = "แสดง PDF แล้ว";
})();
